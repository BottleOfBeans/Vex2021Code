// ---- START VEXCODE CONFIGURED DEVICES ----
// Robot Configuration:
// [Name]               [Type]        [Port(s)]
// Controller1          controller                    
// RightBack            motor         17              
// LeftBack             motor         2               
// Grabby               motor         1               
// LeftFront            motor         16              
// LeftLift             motor         10              
// RightLift            motor         20              
// Inertial             inertial      7               
// RightFront           motor         19              
// Convy                motor         13              
// ---- END VEXCODE CONFIGURED DEVICES ----
// ---- START VEXCODE CONFIGURED DEVICES ----
// Robot Configuration:
// [Name]               [Type]        [Port(s)]
// Controller1          controller                    
// RightBack            motor         17              
// LeftBack             motor         2               
// Grabby               motor         1               
// LeftFront            motor         16              
// LeftLift             motor         10              
// RightLift            motor         20              
// Inertial             inertial      7               
// RightFront           motor         19              
// Convy                motor         13              
// ---- END VEXCODE CONFIGURED DEVICES ----
// ---- START VEXCODE CONFIGURED DEVICES ----
// Robot Configuration:
// [Name]               [Type]        [Port(s)]
// Controller1          controller                    
// RightBack            motor         17              
// LeftBack             motor         2               
// Grabby               motor         1               
// LeftFront            motor         16              
// LeftLift             motor         10              
// RightLift            motor         15              
// Inertial             inertial      7               
// RightFront           motor         19              
// Convy                motor         13              
// ---- END VEXCODE CONFIGURED DEVICES ----
// ---- START VEXCODE CONFIGURED DEVICES ----
// Robot Configuration:
// [Name]               [Type]        [Port(s)]
// Controller1          controller                    
// RightBack            motor         17              
// LeftBack             motor         2               
// Grabby               motor         1               
// LeftFront            motor         16              
// LeftLift             motor         10              
// RightLift            motor         15              
// Inertial             inertial      7               
// RightFront           motor         20              
// Convy                motor         13              
// ---- END VEXCODE CONFIGURED DEVICES ----
// ---- START VEXCODE CONFIGURED DEVICES ----
// Robot Configuration:
// [Name]               [Type]        [Port(s)]
// Controller1          controller                    
// RightBack            motor         17              
// LeftBack             motor         2               
// Grabby               motor         1               
// LeftFront            motor         16              
// LeftLift             motor         10              
// RightLift            motor         15              
// Inertial             inertial      18              
// RightFront           motor         20              
// Convy                motor         13              
// ---- END VEXCODE CONFIGURED DEVICES ----
// ---- START VEXCODE CONFIGURED DEVICES ----
// Robot Configuration:
// [Name]               [Type]        [Port(s)]
// Controller1          controller                    
// RightBack            motor         4               
// LeftBack             motor         2               
// Grabby               motor         1               
// LeftFront            motor         16              
// LeftLift             motor         10              
// RightLift            motor         15              
// Inertial             inertial      18              
// RightFront           motor         20              
// Convy                motor         13              
// ---- END VEXCODE CONFIGURED DEVICES ----
// ---- START VEXCODE CONFIGURED DEVICES ----
// Robot Configuration:
// [Name]               [Type]        [Port(s)]
// Controller1          controller                    
// RightBack            motor         4               
// LeftBack             motor         2               
// Grabby               motor         1               
// LeftFront            motor         5               
// LeftLift             motor         10              
// RightLift            motor         15              
// Inertial             inertial      18              
// RightFront           motor         20              
// Convy                motor         13              
// ---- END VEXCODE CONFIGURED DEVICES ----
// ---- START VEXCODE CONFIGURED DEVICES ----
// Robot Configuration:
// [Name]               [Type]        [Port(s)]
// Controller1          controller                    
// RightBack            motor         4               
// LeftBack             motor         2               
// Grabby               motor         1               
// LeftFront            motor         5               
// LeftLift             motor         10              
// RightLift            motor         15              
// Inertial             inertial      18              
// RightFront           motor         20              
// Convy                motor         16              
// ---- END VEXCODE CONFIGURED DEVICES ----
// ---- START VEXCODE CONFIGURED DEVICES ----
// Robot Configuration:
// [Name]               [Type]        [Port(s)]
// Controller1          controller                    
// RightBack            motor         4               
// LeftBack             motor         2               
// Grabby               motor         1               
// LeftFront            motor         5               
// LeftLift             motor         11              
// RightLift            motor         15              
// Inertial             inertial      18              
// RightFront           motor         20              
// Convy                motor         16              
// ---- END VEXCODE CONFIGURED DEVICES ----
// ---- START VEXCODE CONFIGURED DEVICES ----
// Robot Configuration:
// [Name]               [Type]        [Port(s)]
// Controller1          controller                    
// RightBack            motor         4               
// LeftBack             motor         2               
// Grabby               motor         1               
// LeftFront            motor         10              
// LeftLift             motor         11              
// RightLift            motor         15              
// Inertial             inertial      18              
// RightFront           motor         20              
// Convy                motor         16              
// ---- END VEXCODE CONFIGURED DEVICES ----
// ---- START VEXCODE CONFIGURED DEVICES ----
// Robot Configuration:
// [Name]               [Type]        [Port(s)]
// Controller1          controller                    
// RightBack            motor         4               
// LeftBack             motor         5               
// Grabby               motor         1               
// LeftFront            motor         10              
// LeftLift             motor         11              
// RightLift            motor         15              
// Inertial             inertial      18              
// RightFront           motor         20              
// Convy                motor         16              
// ---- END VEXCODE CONFIGURED DEVICES ----
// ---- START VEXCODE CONFIGURED DEVICES ----
// Robot Configuration:
// [Name]               [Type]        [Port(s)]
// Controller1          controller                    
// RightBack            motor         4               
// LeftBack             motor         5               
// Grabby               motor         6               
// LeftFront            motor         10              
// LeftLift             motor         11              
// RightLift            motor         15              
// Inertial             inertial      18              
// RightFront           motor         20              
// Convy                motor         16              
// ---- END VEXCODE CONFIGURED DEVICES ----
/*----------------------------------------------------------------------------*/
/*                                                                            */
/*    Module:       main.cpp                                                  */
/*    Author:       joe                                                       */
/*    Created:      Sat Sep 18 2021                                           */
/*   Derivitiveescription:  V5 project                                        */
/*                                                                            */
/*----------------------------------------------------------------------------*/

// ---- START VEXCODE CONFIGUREDDerivitiveEVICES ----
// Robot Configuration: 
// [Name]               [Type]        [Port(s)]
// LeftFrontBack        motor         11              
// LeftFront            motor         4               
// RightBack            motor         20              
// RightFront           motor         10              
// Inertial             inertial      7               
// Lift                 motor_group   1, 2            
// Controller1          controller                    
// ---- END VEXCODE CONFIGUREDDerivitiveEVICES ----

#include "vex.h"
using namespace vex;


void DriverCode(){
    while(true){

      int leftWheelSplit =  Controller1.Axis3.position(percent) + Controller1.Axis1.position(percent);
      int rightWheelSplit = (Controller1.Axis3.position(percent)) - Controller1.Axis1.position(percent);
      
      

      if (Controller1.ButtonR1.pressing() == true){ //This is your Conveyor Belt
        Convy.spin(forward, 100, pct);
      }
      else if(Controller1.ButtonR2.pressing() == true){    
        Convy.spin(reverse, 100, pct); 
      }else{ //This is your Conveyor Belt on drugs
        Convy.stop(hold);
      }

      if (Controller1.ButtonL1.pressing() == true){ //This is your Lift
        LeftLift.spin(forward, 100, pct);
        RightLift.spin(forward, 100, pct);
      }
      else if(Controller1.ButtonL2.pressing() == true){    
        LeftLift.spin(reverse, 100, pct);
        RightLift.spin(reverse, 100, pct); 
      
      }else{ //This is your Lift on drugs
        LeftLift.stop(hold);
        RightLift.stop(hold);
      }

      if (Controller1.ButtonX.pressing() == true){ //This is your Grabby
        Grabby.spin(forward, 100, pct);
      }
      else if (Controller1.ButtonB.pressing() == true){    
        Grabby.spin(reverse, 100, pct); 
      }else{ //This is your Grabby on drugs
        Grabby.stop(hold);
      }
   
      //SplitDerivitiverive Move
      LeftFront.spin(forward, leftWheelSplit, pct); 
      RightFront.spin(forward, rightWheelSplit, pct);
      
      LeftBack.spin(forward, leftWheelSplit, pct);
      RightBack.spin(forward, rightWheelSplit, pct);

    }
  }
      
void Turnn(double angle)
{
  double kp = .4, kd = .0, ki = 0;
  double Porportional=0, Integral=0,Derivitive = 0;
  double lastError = angle - Inertial.rotation(deg);
  //int sign = 1;
  while(true)
  {
    double currentAngle = Inertial.rotation(deg);

    
    double error = angle - currentAngle;  
    Porportional = error * kp;
    Integral += error * ki;
    Derivitive = (error - lastError) * kd;  
    lastError = error;

    LeftFront.spin(fwd , Porportional+Integral+Derivitive , pct);
    RightFront.spin(fwd, Porportional+Integral+Derivitive,  pct);
    LeftBack.spin(fwd , Porportional+Integral+Derivitive , pct);
    RightBack.spin(fwd, Porportional+Integral+Derivitive,  pct);

    if(abs(Porportional +Integral+ Derivitive) < 1 && abs(Derivitive) < 1 && abs(Porportional) < 1)      
    {
      LeftFront.stop(brakeType::brake);
      RightFront.stop(brakeType::brake);
      LeftBack.stop(brakeType::brake);
      RightFront.stop(brakeType::brake);        
    }
  }        
}

int CheckDirection(double val){

  if(val > 0){
    return 1;}
  else{
  return -1;}

}


void drive(double inches,double completeTime = 5000, double maxSpeed = 100) // direction: 0 forward, -1 backward, 2 strafe left, -2 strafe right
{
  double target = inches / (3.1415 * 4);

  target *= 360*2;
  LeftFront.resetRotation();
  double kp = .37, ki = 0, kd = .3;
  
  double P = 0, I = 0, D = 0;
  double error, lastError = 0;
  double motorSpeed = 0;
  
  Brain.Timer.clear();
  while(true)
  {
    
      error = -LeftFront.rotation(rotationUnits::deg) + target;
 
    P = kp * error;
    if(fabs(error) < 50)
    {
      I += ki * error;

    }
    D = kd * (error - lastError);
    lastError = error;

    motorSpeed = P + I + D;
    if(fabs(motorSpeed) > maxSpeed)
    {
      motorSpeed = CheckDirection(motorSpeed) * maxSpeed;
    }
    if(fabs(error) < .2 && fabs(lastError) < .2)
      motorSpeed = 0;

        
    double anglePower = 0;
    if(fabs(motorSpeed) > 1)
    {
       anglePower = 0;
    }
    
    LeftFront.spin(directionType::fwd, motorSpeed , percentUnits::pct);
    LeftBack.spin(directionType::fwd, motorSpeed , percentUnits::pct);   
    RightFront.spin(directionType::fwd, motorSpeed+anglePower, percentUnits::pct);
    RightBack.spin(directionType::fwd, motorSpeed+anglePower, percentUnits::pct);
    
    if(fabs(motorSpeed) < 1)
      break;
    task::sleep(20);
  }
  LeftBack.stop(brakeType::hold);
  LeftFront.stop(brakeType::hold);
  RightFront.stop(brakeType::hold);
  RightBack.stop(brakeType::hold);  

}


// void AutoCode(){
//   //DriveForward() is in inches
//   //DriveTurn is inDerivitiveegrees
  
//   drive(30);
//   Turnn(15.31);
//   drive(43.5459); 
// }


int main() {
  DriverCode();
//   // Initial`();
//   Inertial.calibrate();
//   Inertial.setRotation(0, degrees);
//   this_thread::sleep_for(1000);

//   //Code After Here  
//   AutoCode();
}